<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EVEX â€” BCA Expertise Â· Formulaire REP</title>
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="css/rep.css">
</head>
<body>
<div class="app-layout">

  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="sidebar-logo">
      <div class="logo-brand">BCA Expertise</div>
      <div class="logo-app">EVEX</div>
      <div class="logo-sub">Ã‰vÃ©nements Exceptionnels</div>
    </div>
    <div class="sidebar-event">
      <div class="ev-label">Ã‰vÃ©nement actif</div>
      <div class="ev-code">5G1</div>
      <div class="ev-name">GrÃªle Anglet â€” Juin 2025</div>
    </div>
    <nav class="sidebar-nav">
      <div class="nav-section">Navigation</div>
      <div class="nav-item" data-nav="dashboard" onclick="window.location.href='dashboard.html'">
        <span class="nav-icon">ğŸš—</span>
        Parc de vÃ©hicules
      </div>
      <div class="nav-item admin-only" style="display:none" data-nav="admin" onclick="window.location.href='admin.html'">
        <span class="nav-icon">ğŸ“Š</span>
        Administration
      </div>
      <div class="nav-section">Dossier actif</div>
      <div class="nav-item active" data-nav="rep">
        <span class="nav-icon">ğŸ“</span>
        Formulaire REP
      </div>
    </nav>
    <div class="sidebar-user">
      <div class="user-avatar">?</div>
      <div class="user-info">
        <div class="user-name">â€”</div>
        <div class="user-role">â€”</div>
      </div>
      <button class="user-logout" title="DÃ©connexion">â‡¥</button>
    </div>
  </aside>

  <!-- MAIN -->
  <main class="main-content">
    <div class="topbar">
      <div class="topbar-title">Formulaire REP</div>
      <button class="btn btn-secondary btn-sm" onclick="window.location.href='dashboard.html'">
        â† Retour au parc
      </button>
      <button class="btn btn-secondary btn-sm" onclick="releaseVehicle()">
        ğŸ”“ LibÃ©rer
      </button>
      <button class="btn btn-secondary btn-sm" onclick="saveRep()">
        ğŸ’¾ Enregistrer
      </button>
      <button class="btn btn-primary btn-sm" onclick="closeVehicle()">
        âœ… ClÃ´turer le dossier
      </button>
    </div>

    <div class="page-content">

      <!-- Vehicle Header -->
      <div class="vehicle-header">
        <div>
          <div class="vh-immat">â€”</div>
          <div class="vh-brand">â€”</div>
        </div>
        <div class="vh-meta">
          <div class="vh-meta-item">
            <label>NÂ° Ligne</label>
            <span data-vh="num">â€”</span>
          </div>
          <div class="vh-meta-item">
            <label>VIN</label>
            <span data-vh="vin">â€”</span>
          </div>
          <div class="vh-meta-item">
            <label>1Ã¨re MEC</label>
            <span data-vh="mec">â€”</span>
          </div>
          <div class="vh-meta-item">
            <label>KilomÃ©trage</label>
            <span data-vh="km">â€”</span>
          </div>
          <div class="vh-meta-item">
            <label>Usage</label>
            <span data-vh="usage">â€”</span>
          </div>
        </div>
        <div class="vh-status">
          <div class="vh-status-badge"></div>
          <div class="vh-lock"></div>
        </div>
      </div>

      <!-- Qualification -->
      <div class="qual-selector">
        <span class="qual-label">Qualification :</span>
        <button class="qual-btn" data-status="none">âšª Pas encore vu</button>
        <button class="qual-btn active-grele" data-status="grele">ğŸŸ¢ GrÃªlÃ© (Oui)</button>
        <button class="qual-btn" data-status="non">ğŸ”´ Non grÃªlÃ© (Non)</button>
      </div>

      <!-- REP Form -->
      <div class="card">
        <div class="card-header">
          <div class="card-title">ğŸ“‹ DonnÃ©es d'expertise â€” Formulaire REP</div>
        </div>
        <div class="card-body">

          <!-- SECTION 1: Taux -->
          <div class="form-section-title">
            <div class="fst-accent"></div>
            Taux RÃ©parateur (â‚¬/h)
          </div>
          <div class="rate-grid">
            <div class="form-group">
              <label class="form-label">Taux DÃ©bosselage</label>
              <input type="number" id="tauxDeb" class="form-control" placeholder="â‚¬/h" step="0.01">
            </div>
            <div class="form-group">
              <label class="form-label">Taux MO1</label>
              <input type="number" id="tauxMO1" class="form-control" placeholder="â‚¬/h" step="0.01">
            </div>
            <div class="form-group">
              <label class="form-label">Taux MO2</label>
              <input type="number" id="tauxMO2" class="form-control" placeholder="â‚¬/h" step="0.01">
            </div>
            <div class="form-group">
              <label class="form-label">Taux MO Peinture</label>
              <input type="number" id="tauxMOP" class="form-control" placeholder="â‚¬/h" step="0.01">
            </div>
          </div>

          <!-- SECTION 2: Montants -->
          <div class="form-section-title" style="margin-top:20px">
            <div class="fst-accent"></div>
            Montants
          </div>
          <div class="rep-grid">
            <div class="form-group">
              <label class="form-label">Montant DÃ©bosselage (â‚¬ HT) â€” Si GrÃªle</label>
              <input type="number" id="montantDeb" class="form-control" placeholder="AO DSP retenu" step="0.01">
            </div>
            <div class="form-group">
              <label class="form-label">CoÃ»t PiÃ¨ces (â‚¬ HT)</label>
              <input type="number" id="coutPieces" class="form-control" placeholder="Total piÃ¨ces Ã  remplacer" step="0.01">
            </div>
            <div class="form-group rep-full">
              <label class="form-label">DÃ©tail des piÃ¨ces</label>
              <textarea id="detailPieces" class="form-control" rows="2" placeholder="Description succincte des piÃ¨ces Ã  remplacer..."></textarea>
            </div>
          </div>

          <!-- SECTION 3: Main d'oeuvre -->
          <div class="form-section-title" style="margin-top:20px">
            <div class="fst-accent"></div>
            Main d'Å“uvre (heures)
          </div>
          <div class="rate-grid">
            <div class="form-group">
              <label class="form-label">MO1</label>
              <input type="number" id="mo1" class="form-control" placeholder="0.0h" step="0.1">
            </div>
            <div class="form-group">
              <label class="form-label">MO2</label>
              <input type="number" id="mo2" class="form-control" placeholder="0.0h" step="0.1">
            </div>
            <div class="form-group">
              <label class="form-label">MO3</label>
              <input type="number" id="mo3" class="form-control" placeholder="0.0h" step="0.1">
            </div>
            <div class="form-group">
              <label class="form-label">MO Peinture</label>
              <input type="number" id="mop" class="form-control" placeholder="0.0h" step="0.1">
            </div>
          </div>

          <!-- SECTION 4: Remises -->
          <div class="form-section-title" style="margin-top:20px">
            <div class="fst-accent"></div>
            Remises &amp; IngrÃ©dients
          </div>
          <div class="rep-grid">
            <div class="form-group">
              <label class="form-label">IngrÃ©dient Peinture (h)</label>
              <input type="number" id="ing" class="form-control" placeholder="0.0h" step="0.1">
            </div>
            <div></div>
            <div class="form-group">
              <label class="form-label">Remise sur DÃ©bosselage (%)</label>
              <input type="number" id="remiseDeb" class="form-control" placeholder="%" step="0.5" min="0" max="100">
            </div>
            <div class="form-group">
              <label class="form-label">Remise sur PiÃ¨ces / MO (%)</label>
              <input type="number" id="remisePieces" class="form-control" placeholder="%" step="0.5" min="0" max="100">
            </div>
          </div>

          <!-- MONTANT RÃ‰PARATION -->
          <div class="montant-card">
            <div>
              <div class="montant-label">Montant RÃ©paration</div>
              <div class="montant-value">0,00 â‚¬</div>
              <div class="montant-sub">CalculÃ© automatiquement Â· Lecture seule</div>
            </div>
            <div class="montant-formula">
              =(DebÃ—(1-RemDeb)) +<br>
              ((PiÃ¨ces+MO1Ã—TxMO1+MO2Ã—TxMO2+<br>
              MO3Ã—TxMO3+MOPÃ—TxMOP)Ã—(1-RemPiÃ¨ces))
            </div>
          </div>

          <!-- SECTION 5: Facturation -->
          <div class="form-section-title" style="margin-top:28px">
            <div class="fst-accent"></div>
            Facturation
          </div>
          <div class="fact-grid">
            <!-- Partenaire -->
            <div class="fact-card">
              <div class="fact-card-title">ğŸ¤ DÃ©bosseleur Partenaire</div>
              <div class="form-group">
                <label class="form-label">Montant Facture (â‚¬ HT)</label>
                <input type="number" id="factPartMontant" class="form-control" placeholder="0.00" step="0.01">
              </div>
              <div class="form-group">
                <label class="form-label">NumÃ©ro de Facture</label>
                <input type="text" id="factPartNum" class="form-control" placeholder="ex: FAC-2025-0001">
              </div>
              <div class="form-group">
                <label class="form-label">Date Facture</label>
                <input type="text" id="factPartDate" class="form-control" placeholder="JJ/MM/AAAA">
              </div>
            </div>
            <!-- AssurÃ© -->
            <div class="fact-card">
              <div class="fact-card-title">ğŸ‘¤ DÃ©bosseleur AssurÃ© / Hors Partenaire</div>
              <div class="form-group">
                <label class="form-label">Montant Facture (â‚¬ HT)</label>
                <input type="number" id="factAssureMontant" class="form-control" placeholder="0.00" step="0.01">
              </div>
              <div class="form-group">
                <label class="form-label">NumÃ©ro de Facture</label>
                <input type="text" id="factAssureNum" class="form-control" placeholder="ex: FAC-2025-0001">
              </div>
              <div class="form-group">
                <label class="form-label">Date Facture</label>
                <input type="text" id="factAssureDate" class="form-control" placeholder="JJ/MM/AAAA">
              </div>
            </div>
          </div>

          <!-- SECTION 6: ComplÃ©ments -->
          <div class="form-section-title" style="margin-top:28px">
            <div class="fst-accent"></div>
            Informations complÃ©mentaires
          </div>
          <div class="rep-grid">
            <div class="form-group rep-full">
              <label class="form-label">Commentaires</label>
              <textarea id="commentaires" class="form-control" rows="2" placeholder="Commentaires libres..."></textarea>
            </div>
            <div class="form-group">
              <label class="form-label">Valeur d'achat (â‚¬ HT)</label>
              <input type="number" id="valeurAchat" class="form-control" placeholder="0.00" step="0.01">
            </div>
            <div class="form-group">
              <label class="form-label">IndemnitÃ© de dÃ©prÃ©ciation</label>
              <input type="number" id="depreciation" class="form-control" placeholder="Suivant contrat" step="0.01">
            </div>
          </div>

        </div><!-- /card-body -->
      </div><!-- /card -->

      <!-- Sticky bottom actions -->
      <div class="rep-action-bar">
        <span style="font-size:12px;color:var(--text-muted)">
          ğŸ’¾ Auto-sauvegarde active Â· DonnÃ©es locales Ã  la dÃ©mo
        </span>
        <div style="margin-left:auto;display:flex;gap:10px">
          <button class="btn btn-secondary" onclick="releaseVehicle()">ğŸ”“ LibÃ©rer le vÃ©hicule</button>
          <button class="btn btn-secondary" onclick="saveRep()">ğŸ’¾ Enregistrer</button>
          <button class="btn btn-primary" onclick="closeVehicle()">âœ… ClÃ´turer le dossier</button>
        </div>
      </div>

    </div><!-- /page-content -->
  </main>
</div>

<div class="toast-container"></div>
<script src="js/data.js"></script>
<script src="js/auth.js"></script>
<script src="js/rep.js"></script>
</body>
</html>
